---
- name: "ğŸš€ LXC Container Deployment auf Proxmox"
  hosts: proxmox
  become: yes
  gather_facts: yes
  vars_files:
    - ../group_vars/all/vault.yml

  pre_tasks:
    - name: "ğŸ“‹ Zeige Deployment-Parameter"
      debug:
        msg: |
          ========================================
          ğŸš€ LXC CONTAINER DEPLOYMENT
          ========================================
          Ziel-Host: {{ inventory_hostname }}
          Container-ID: {{ ct_id | default('auto') }}
          Hostname: {{ ct_hostname | default('auto') }}
          Template: {{ ct_template | default('Debian 12') }}
          VLAN: {{ ct_vlan | default('20') }}
          ========================================
      tags: [info]

    - name: "ğŸ” PrÃ¼fe Vault-Zugriff"
      debug:
        msg: "âœ… Vault erfolgreich entschlÃ¼sselt"
      when: vault_default_root_password is defined
      tags: [vault_check]

  roles:
    - role: proxmox_lxc
      tags: [deployment, lxc]

  post_tasks:
    - name: "âœ… Deployment erfolgreich abgeschlossen"
      debug:
        msg: |
          ========================================
          âœ… DEPLOYMENT ABGESCHLOSSEN
          ========================================
          Container erfolgreich erstellt und konfiguriert!

          NÃ¤chste Schritte:
          1. UniFi-Registrierung durchfÃ¼hren (siehe oben)
          2. Container mit SSH testen
          3. Weitere Services installieren

          SSH-Zugang:
          ssh root@{{ container_ip_result.stdout | default('CONTAINER_IP') }}

          ========================================
      tags: [summary]
